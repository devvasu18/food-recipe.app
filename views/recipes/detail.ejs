<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= recipe.title %> - FoodHub</title>
  <link rel="stylesheet" href="/detail.css" />
  <link rel="stylesheet" href="/index.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<nav class="navbar">
    <div class="logo">
      <a href="/">üçΩÔ∏è FoodHub</a>
    </div>
    <ul class="nav-links">
      <li><a href="/">Home</a></li>
      <% if (isAuthenticated) { %>
        <li><a href="/my-recipes">My Recipes</a></li>
        <li><a href="/orders">My Orders</a></li>
      <% } %>
      <li><a href="/about">About</a></li>
      <% if (isAuthenticated) { %>
        <li><a href="/logout">Logout</a></li>
      <% } else { %>
        <li><a href="/login">Login</a></li>
      <% } %>
    </ul>
  </nav>

<main class="page-content">
  <section class="detail-hero">
    <div class="detail-hero-overlay"></div>
    <div class="detail-hero-content">
      <h1><%= recipe.title %></h1>
    </div>
  </section>

  <div class="detail-container">
    <div class="detail-image">
      <img src="/uploads/<%= recipe.image %>" alt="<%= recipe.title %>">
    </div>

    <div class="detail-info">
      <h2>Price: $<%= recipe.price %></h2>
      <p><strong>Ingredients:</strong> <%= recipe.ingredients %></p>
      <p><strong>Steps:</strong> <%= recipe.steps %></p>

  <!-- Rating Section -->
  <form class="rating-form" data-recipe-id="<%= recipe._id %>">
    <input type="hidden" class="rating-value" value="<%= recipe.userRating || '' %>">
    <div class="star-container">
      <% for (let i = 1; i <= 5; i++) { %>
        <i class="fa-star <%= recipe.userRating && i <= recipe.userRating ? 'fa-solid active' : 'fa-regular' %> star"
           data-value="<%= i %>"></i>
      <% } %>
      <span class="avg-rating">(<%= recipe.avgRating %>)</span>
    </div>
  </form>

  <!-- Reviews Section -->
  <h2>Reviews</h2>

  <% recipe.reviews.forEach(review => { %>
    <div class="review-card">
      <strong><%= review.userName %></strong>  
      <p><%= review.content %></p>
      <small>Rating: <%= review.rating %>/5</small>
    </div>
  <% }) %>
 <% if (isAuthenticated) { %>
    <form id="review-form">
      <textarea name="content" placeholder="Write your review..." required></textarea>
     
      <button type="submit">Submit Review</button>
    </form>
  <% } else { %>
    <p>Please <a href="/login">login</a> to add a review.</p>
  <% } %>

  <footer>
    <div class="footer-content">
      <h3>FoodHub</h3>
      <p>Elevating your dining experience with royal elegance since 2024.</p>
      <div class="social-links">
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="#"><i class="fab fa-pinterest"></i></a>
      </div>
      <p class="copyright">¬© 2024 FoodHub. All rights reserved.</p>
    </div>
  </footer>

<script>
  const stars = document.querySelectorAll('.star');
  const ratingInput = document.getElementById('ratingValue');
  const ratingForm = document.querySelector('.rating-form');

  stars.forEach(star => {
    star.addEventListener('click', () => {
      const rating = star.getAttribute('data-value');
      ratingInput.value = rating;

      stars.forEach(s => {
        s.classList.toggle('active', s.getAttribute('data-value') <= rating);
      });

      ratingForm.submit();
    });
  });
</script>
 <script>
  const reviewForm = document.getElementById('review-form');
  if (reviewForm) {
    reviewForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const content = reviewForm.content.value.trim();
      const recipeId = "<%= recipe._id %>";

      if (!content) {
        alert("Please write a review.");
        return;
      }

      try {
        const response = await fetch(`/recipes/${recipeId}/review`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content })  // Only sending content
        });

        const result = await response.json();
        if (result.success) {
          location.reload();
        } else {
          alert(result.message);
        }
      } catch (err) {
        console.error(err);
        alert('Error submitting review');
      }
    });
  }
</script>


</body>
</html>
